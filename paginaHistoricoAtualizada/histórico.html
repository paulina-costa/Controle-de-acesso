<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="src/img/logo_elechtech.png">
    <link rel="stylesheet" href="./src/css/style.css">
    <link rel="stylesheet" href="./src/css/reset.css">
    <script src="./script.js"></script>
    <title>Histórico</title>
</head>
<body>
    <header>
        <nav class="nav-bar">
            <div class="logoSebas">
                <img src="src/img/Logo_Sebas.png" width="50px" right="40px">
            </div>
            <div class="nav-list">
                <ul>
                    <li class="nav-item"><a href="../Home/home.html" class="nav-link">Início</a></li>
                    <li class="nav-item"><a href="../paginaCadastro/cadastro.html" class="nav-link">Cadastro</a></li>
                    <li class="nav-item"><a href="../paginaHistoricoAtualizada/histórico.html" class="nav-link">Histórico</a></li>
                </ul>
            </div>
            <div class="logoSite">
                <img src="src/img/logo_elechtech.png" width="50px">
            </div>
        </nav>
    </header>
    <main>
        <div class="descricao">
            <h1 class="tituloDescricao">Histórico</h1>
            <br>
            <p>Área onde você pode visualizar todos os chamados, sejam eles, em andamento, concluído ou não concluído.</p>
        </div>
        <section class="formularioHistorico">
            <form id="filterForm">
                <div class="form-grid">
                    <!-- Campos de seleção -->
                    <div class="form-group">
                        <label for="tipo-chamado">Tipos de chamado</label>
                        <select id="tipo-chamado" name="tipo-chamado">
                            <option disabled selected>Selecione o tipo do chamado</option>
                            <option value="Substituição">Substituição</option>
                            <option value="Formatação">Formatação</option>
                            <option value="Manutenção">Manutenção</option>
                            <option value="Outros">Outros</option> 
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="nivel-urgencia">Nível de Urgência</label>
                        <select id="nivel-urgencia" name="nivel-urgencia">
                            <option disabled selected>Selecione o nível de urgência</option>
                            <option value="Crítico">Crítico</option>
                            <option value="Alto">Alto</option>
                            <option value="Médio">Médio</option>
                            <option value="Baixo">Baixo</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="setor">Setor:</label>
                        <select id="setor" name="setor">
                            <option disabled selected>Selecione o setor</option>
                            <option value="Secretaria">Secretaria</option>
                            <option value="Pátio">Pátio</option>
                            <option value="Sala 5">Sala 5</option>
                            <option value="Sala 2">Sala 2</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="equipamento">Equipamento</label>
                        <select id="equipamento" name="equipamento">
                            <option disabled selected>Selecione o nome do equipamento</option>
                            <option value="Computador">Computador</option>
                            <option value="Mouse">Mouse</option>
                            <option value="Teclado">Teclado</option>
                            <option value="Alto-Falante">Alto-Falante</option>
                            <option value="Estabilizador">Estabilizador</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="Resolução">Resolução</label>
                        <select id="resolucao" name="resolucao">
                            <option disabled selected>Selecione a resolução</option>
                            <option value="Em andamento">Em andamento</option>
                            <option value="Concluído">Concluído</option>
                            <option value="Não concluído">Não concluído</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="datas">Filtrar por Data</label>
                        <select id="datas" name="datas">
                            <option disabled selected>Selecione o período</option>
                            <option value="7dias">Últimos 7 dias</option>
                            <option value="1mes">Último 1 mês</option>
                            <option value="3meses">Últimos 3 meses</option>
                            <option value="6meses">Últimos 6 meses</option>
                            <option value="1ano">Último 1 ano</option>
                        </select>
                    </div>
                </div>
                <div class="filtrar">
                    <button type="button" class="btnFiltrar" onclick="filtrarChamados()">Filtrar</button>
                </div>
            </form>
        </section>
        <section class="tabelaHistorico">
            <table border="1" style="text-align: center;">
                <thead>
                    <tr>
                        <th>Tipo do Chamado</th>
                        <th>Nível de Urgência</th>
                        <th>Setor</th>
                        <th>Equipamento</th>
                        <th>Data</th>
                        <th>Resolução</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <!-- Resultados da filtragem aparecerão aqui -->
                </tbody>
            </table>
            <a href="../Home/home.html">
                <div class="btn">Voltar</div>
            </a>
        </section>
        <!-- Modal de Confirmação -->
        <div id="confirmModal" class="modal">
            <div class="modal-content">
                <span class="close-btn">&times;</span>
                <h2>Confirmar Exclusão</h2>
                <p>Tem certeza de que deseja excluir este chamado? Esta ação não pode ser desfeita.</p>
                <button id="confirmDeleteBtn" class="btn-confirm">Confirmar</button>
                <button id="cancelDeleteBtn" class="btn-cancel">Cancelar</button>
            </div>
        </div>

    </main>
    <footer>
        <div class="footer-container">
            <div class="footer-section sobre">
                <h3>Sobre</h3>
                <p>Um compromisso inabalável com a excelência acadêmica e a formação integral de seus alunos.</p>
            </div>
            <div class="footer-section mapa-do-site">
                <h3>Mapa do Site</h3>
                <ul>
                    <li class="naveg-item"><a href="../Home/home.html" class="nav-link">Início</a></li>
                    <li class="naveg-item"><a href="../paginaCadastro/cadastro.html" class="nav-link">Cadastro</a></li>
                    <li class="naveg-item"><a href="../paginaHistoricoAtualizada/histórico.html" class="nav-link">Histórico</a></li>
                </ul>
            </div>
            <div class="footer-contato">
                <h3>Informações de Contato</h3>
                <p><a href="https://www.google.com/maps/place/E.E.E.F.M.+S%C3%A3o+Sebasti%C3%A3o/@-7.2117707,-35.8804125,21z/data=!4m6!3m5!1s0x7ac1e52917e6839:0xbd4d2c16e15fa8b5!8m2!3d-7.2117012!4d-35.8800973!16s%2Fg%2F1trpldrv?entry=ttu">Estelita Cruz, 307 - Alto Branco, Campina Grande - PB, 58401-470</a></p>
                <p>83 3342-2529</p>
            </div>
        </div>
    </footer>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const chamadoId = urlParams.get('id');
        
            if (chamadoId) {
                try {
                    const response = await fetch(`http://localhost:3000/filtros/${chamadoId}`);
                    if (!response.ok) throw new Error('Erro ao carregar os dados do chamado');
        
                    const chamado = await response.json();
                    preencherFormulario(chamado);
                } catch (error) {
                    console.error('Erro ao carregar dados do chamado:', error);
                }
            }
        });
        
        function preencherFormulario(chamado) {
            document.getElementById('nomeUsuario').value = chamado.nomeUsuario;
            document.getElementById('setor').value = chamado.setor;
            document.getElementById('tiposDoChamado').value = chamado.tiposDoChamado;
            document.getElementById('nivelDeUrgencia').value = chamado.nivelDeUrgencia;
            document.getElementById('nomeEquipamento').value = chamado.nomeEquipamento;
            document.getElementById('FK_tecnicoResponsavelPeloChamado').value = chamado.FK_tecnicoResponsavelPeloChamado;
            document.getElementById('email').value = chamado.email;
            document.getElementById('descricao').value = chamado.descricao;
            document.getElementById('datas').value = new Date(chamado.datas).toISOString().split('T')[0];
        }
        </script>
</body>
</html>