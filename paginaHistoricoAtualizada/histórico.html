<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./src/css/style.css">
    <link rel="stylesheet" href="./src/css/reset.css">
    <title>Histórico</title>
</head>
<body>
    <header>
        <nav class="nav-bar">
            <div class="logoSebas">
                <img src="src/img/Logo_Sebas.png" width="50px">
            </div>
            <div class="nav-list">
                <ul>
                    <li class="nav-item"><a href="../Home/home.html" class="nav-link">Início</a></li>
                    <li class="nav-item"><a href="../paginaCadastro/cadastro.html" class="nav-link">Cadastro</a></li>
                    <li class="nav-item"><a href="../paginaHistoricoAtualizada/histórico.html" class="nav-link">Histórico</a></li>
                </ul>
            </div>
            <div class="logoSite">
                <img src="src/img/logo_elechtech.png" width="50px">
            </div>
        </nav>
    </header>
    <main>
        <div class="descricao">
            <h1 class="tituloDescricao">Histórico</h1>
            <br>
            <p>Área onde você pode visualizar todos os chamados, sejam eles, em andamento, concluído ou não concluído.</p>
        </div>
        <section class="formularioHistorico">
            <form id="filterForm">
                <div class="form-grid">
                    <!-- Campos de seleção -->
                    <div class="form-group">
                        <label for="tipo-chamado">Tipos de chamado:</label>
                        <select id="tipo-chamado" name="tipo-chamado">
                            <option disabled selected>Selecione o tipo do chamado</option>
                            <option value="Substituição">Substituição</option>
                            <option value="Formatação">Formatação</option>
                            <option value="Manutenção">Manutenção</option>
                            <option value="Outros">Outros</option> 
                        </select>
                    </div>
                    <!-- Outros campos de seleção -->
                    <div class="form-group">
                        <label for="nivel-urgencia">Nível de Urgência:</label>
                        <select id="nivel-urgencia" name="nivel-urgencia">
                            <option disabled selected>Selecione o nível de urgência</option>
                            <option value="Crítico">Crítico</option>
                            <option value="Alto">Alto</option>
                            <option value="Médio">Médio</option>
                            <option value="Baixo">Baixo</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="setor">Setor:</label>
                        <select id="setor" name="setor">
                            <option disabled selected>Selecione o setor</option>
                            <option value="Secretaria">Secretaria</option>
                            <option value="Pátio">Pátio</option>
                            <option value="Sala 5">Sala 5</option>
                            <option value="Sala 2">Sala 2</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="equipamento">Equipamento:</label>
                        <select id="equipamento" name="equipamento">
                            <option disabled selected>Selecione o nome do equipamento</option>
                            <option value="Computador">Computador</option>
                            <option value="Mouse">Mouse</option>
                            <option value="Teclado">Teclado</option>
                            <option value="Alto-Falante">Alto-Falante</option>
                            <option value="Estabilizador">Estabilizador</option>
                        </select>
                    </div>
                    <!-- Adicione outros selects se necessário -->
                </div>
                <div class="filtrar">
                    <button type="button" class="btnFiltrar" onclick="filtrarChamados()">Filtrar</button>

                </div>
            </form>
        </section>
        <section>
            <table border="1" style="text-align: center;">
                <thead>
                    <tr>
                        <th>Tipo do Chamado</th>
                        <th>Nível de Urgência</th>
                        <th>Setor</th>
                        <th>Equipamento</th>
                        <th>Responsável</th>
                        <th>Data</th>
                        <th>Resolução</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <!-- Resultados da filtragem aparecerão aqui -->
                </tbody>
            </table>
        </section>
        <a href="../Home/home.html">
            <div class="btn">Voltar</div>
        </a>
    </main>
    <footer>
        <div class="footer-container">
            <div class="footer-section sobre">
                <h3>Sobre</h3>
                <p>Um compromisso inabalável com a excelência acadêmica e a formação integral de seus alunos.</p>
            </div>
            <div class="footer-section mapa-do-site">
                <h3>Mapa do Site</h3>
                <ul>
                    <li class="nav-item"><a href="../Home/home.html" class="nav-link">Início</a></li>
                    <li class="nav-item"><a href="../paginaCadastro/cadastro.html" class="nav-link">Cadastro</a></li>
                    <li class="nav-item"><a href="../paginaHistoricoAtualizada/histórico.html" class="nav-link">Histórico</a></li>
                </ul>
            </div>
            <div class="footer-contato">
                <h3>Informações de Contato</h3>
                <p><a href="#">Endereço</a></p>
                <p>Telefone</p>
            </div>
        </div>
    </footer>

    <script>
        // Função para fazer a requisição e preencher a tabela
        async function filtrarChamados() {
    const formData = new FormData(document.getElementById('filterForm'));
    const filterData = {};
    
    // Converte os dados do formulário em um objeto para enviar na requisição
    formData.forEach((value, key) => {
        filterData[key] = value;
    });

    try {
        const response = await fetch('http://localhost:3000/filtros', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(filterData) // Envia os filtros selecionados
        });

        if (!response.ok) {
            throw new Error('Erro ao buscar os dados filtrados');
        }

        const data = await response.json();
        const tableBody = document.getElementById('tableBody');
        
        // Limpa a tabela antes de preenchê-la com novos dados
        tableBody.innerHTML = '';

        // Verifica se há dados no resultado
        if (data && data.data.length > 0) {
            // Preenche a tabela com os resultados filtrados
            data.data.forEach(item => {
                const row = `<tr>
                    <td>${item.tiposDoChamado}</td>
                    <td>${item.nivelDeUrgencia}</td>
                    <td>${item.setor}</td>
                    <td>${item.nomeEquipamento}</td>
                    <td>${item.FK_tecnicoResponsavelPeloChamado}</td>
                    <td>${new Date(item.datas).toLocaleDateString()}</td>
                    <td>${item.resolucao}</td>
                </tr>`;
                tableBody.insertAdjacentHTML('beforeend', row);
            });
        } else {
            // Se não houver resultados, mostra uma mensagem
            const emptyRow = `<tr><td colspan="7">Nenhum chamado encontrado.</td></tr>`;
            tableBody.insertAdjacentHTML('beforeend', emptyRow);
        }

    } catch (error) {
        console.error('Erro ao filtrar chamados:', error);
    }
}

    </script>
</body>
</html>
